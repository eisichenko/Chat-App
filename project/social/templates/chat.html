{% extends 'base.html' %}

{% block title %}
Chat
{% endblock %}

{% block body %}
<h2>Chat</h2>
<br>

<div class="container col-7 chat" id="chat">
    {% if unread_messages|length == 0 and seen_messages|length == 0 %}
        <h3 id="no-msg" class="text-center">No messages yet :(</h3>
    {% else %}
    
        {% for message in seen_messages %}
            {% if message.user_id == current_user.id %}
                <div class="col-6 container user-message">
                    <p class="pe-2 sender-name">
                        {{ message.user.username }}: 
                    </p>
                    <p style="display: inline;">
                        {{ message.text }}
                    </p>
                </div>
                <p class="user-msg-time">
                    {{ (message.date - hours_delta).strftime("%d/%m/%Y %H:%M:%S") }}
                </p>
            {% else %}
                <div class="col-6 container not-user-message">
                    {% if message.user.sid != None %}
                        <p class="ps-1 pe-0 online" style="display: inline;">•</p>
                    {% else %}
                        <p class="ps-1 pe-0 offline" style="display: inline;">•</p>
                    {% endif %}
                    <p class="pe-2 sender-name" style="display: inline;">
                        {{ message.user.username }}: 
                    </p>
                    <p style="display: inline;">
                        {{ message.text }}
                    </p>
                </div>
                <p class="not-user-msg-time">
                    {{ (message.date - hours_delta).strftime("%d/%m/%Y %H:%M:%S") }}
                </p>
            {% endif %}
        {% endfor %}

        {% if unread_messages|length > 0 %}
            <div class="text-center">
                <p id="unread-msg" class="unread-msg mb-0">Unread Messages</p>
                <hr class="unread-msg mt-0">
            </div>
        {% endif %}

        {% for message in unread_messages %}
            <div class="col-6 container not-user-message">
                {% if message.user.sid != None %}
                    <p class="ps-1 pe-0 online" style="display: inline;">•</p>
                {% else %}
                    <p class="ps-1 pe-0 offline" style="display: inline;">•</p>
                {% endif %}
                <p class="pe-2 sender-name" style="display: inline;">
                    {{ message.user.username }}: 
                </p>
                <p style="display: inline;">
                    {{ message.text }}
                </p>
            </div>
            <p class="not-user-msg-time">
                <span style="color: #ff0000 !important;">NEW</span>
                {{ (message.date - hours_delta).strftime("%d/%m/%Y %H:%M:%S") }}
            </p>
        {% endfor %}
    {% endif %}
</div>

<div class="container col-7 chat">
    <form id="message_form" class="container mt-3 chat-form" method="POST">
        <textarea type="text" id="message_text_area" class="form-control w-50 pb-3" maxlength="1000" placeholder="Type here..."></textarea> 
        <span class="invalid" id="server_verdict"><br></span>
        <input class="btn btn-send" value="Send" type="submit" />
    </form>
</div>

{% endblock %}
